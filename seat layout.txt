import 'package:flutter/material.dart';
import 'passenger_details_page.dart';

class SeatLayoutPage extends StatefulWidget {
  final Map<String, dynamic> busDetails;

  const SeatLayoutPage({super.key, required this.busDetails});

  @override
  State<SeatLayoutPage> createState() => _SeatLayoutPageState();
}

class _SeatLayoutPageState extends State<SeatLayoutPage> {
  final int seatPrice = 123;
  final int rows = 10;

  // 2 + 3 layout = 5 seats per row
  late List<List<bool>> selected;

  @override
  void initState() {
    super.initState();
    selected = List.generate(rows, (_) => List.generate(5, (_) => false));
  }

  int get totalPrice =>
      selected.expand((row) => row).where((s) => s).length * seatPrice;

  List<String> get selectedSeats {
    List<String> seats = [];
    for (int r = 0; r < rows; r++) {
      for (int c = 0; c < 5; c++) {
        if (selected[r][c]) {
          seats.add("${r + 1}${String.fromCharCode(65 + c)}");
        }
      }
    }
    return seats;
  }

  Widget seatBox(int r, int c) {
    bool isSelected = selected[r][c];

    return GestureDetector(
      onTap: () {
        setState(() {
          selected[r][c] = !selected[r][c];
        });
      },
      child: Container(
        margin: const EdgeInsets.all(6),
        width: 50,
        height: 50,
        alignment: Alignment.center,
        decoration: BoxDecoration(
          color: isSelected ? Colors.green : Colors.white,
          border: Border.all(color: Colors.green, width: 2),
          borderRadius: BorderRadius.circular(8),
        ),
        child: Text(
          "₹$seatPrice",
          style: TextStyle(
            color: isSelected ? Colors.white : Colors.green,
            fontWeight: FontWeight.bold,
          ),
        ),
      ),
    );
  }

  Widget seatRow(int r) {
    return Row(
      mainAxisAlignment: MainAxisAlignment.center,
      children: [
        // LEFT SIDE (2 seats)
        seatBox(r, 0),
        seatBox(r, 1),

        // AISLE GAP
        const SizedBox(width: 30),

        // RIGHT SIDE (3 seats)
        seatBox(r, 2),
        seatBox(r, 3),
        seatBox(r, 4),
      ],
    );
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text("KSRTC Swift"),
        backgroundColor: Colors.green,
      ),

      body: Column(
        children: [
          // BUS INFO
          Container(
            width: double.infinity,
            color: Colors.green.shade700,
            padding: const EdgeInsets.all(14),
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: const [
                Text("AC Seater",
                    style: TextStyle(color: Colors.white70)),
                SizedBox(height: 6),
                Text("06:00 PM → 05:00 AM",
                    style: TextStyle(
                        color: Colors.white,
                        fontSize: 20,
                        fontWeight: FontWeight.bold)),
              ],
            ),
          ),

          // SEATS
          Expanded(
            child: ListView.builder(
              itemCount: rows,
              itemBuilder: (context, r) => seatRow(r),
            ),
          ),

          // BOTTOM BAR
          Container(
            padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 12),
            decoration: BoxDecoration(
              color: Colors.white,
              boxShadow: [
                BoxShadow(color: Colors.black12, blurRadius: 4)
              ],
            ),
            child: Row(
              children: [
                Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    Text("₹$totalPrice",
        
                        style: const TextStyle(
                            fontSize: 22, fontWeight: FontWeight.bold)),
                    Text(
                      selectedSeats.join(", "),
                      style: const TextStyle(color: Colors.grey),
                    ),
                  ],
                ),
                const Spacer(),
                ElevatedButton(
                  onPressed: selectedSeats.isEmpty ? null : () {      
                      Navigator.push(
          context,
          MaterialPageRoute(
            builder: (_) => PassengerDetailsPage(
              selectedSeats: selectedSeats,
            ),
          ),
        );},
                  style: ElevatedButton.styleFrom(
                    backgroundColor: Colors.red,
                    padding: const EdgeInsets.symmetric(
                        horizontal: 32, vertical: 14),
                  ),
                  child: const Text("NEXT",
                      style: TextStyle(fontSize: 18)),
                )
              ],
            ),
          )
        ],
      ),
    );
  }
}
